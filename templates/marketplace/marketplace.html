{% extends "base.html" %}

{% block title %}Marketplace - Campus Connect{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-store"></i> Marketplace</h1>
        <button class="btn btn-primary" onclick="openModal('addItemModal')">
            <i class="fas fa-plus"></i> Post Item
        </button>
    </div>
    
    <div class="filters-section">
        <div class="filter-group">
            <label for="categoryFilter">Filter by Category:</label>
            <select id="categoryFilter" onchange="filterByCategory(this.value)">
                <option value="">All Categories</option>
                {% for category in categories %}
                <option value="{{ category.category }}" {% if selected_category == category.category %}selected{% endif %}>
                    {{ category.category }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="items-grid">
        {% for item in items %}
        <div class="item-card">
            <div class="item-header">
                <h3>{{ item.title }}</h3>
                <span class="item-price">${{ "%.2f"|format(item.price) }}</span>
            </div>
            <div class="item-content">
                <p class="item-description">{{ item.description }}</p>
                <div class="item-meta">
                    <span class="item-category">{{ item.category }}</span>
                    <span class="item-seller">by {{ item.seller_name }}</span>
                </div>
            </div>
            <div class="item-actions">
                <button class="btn btn-secondary btn-small contact-btn" onclick="revealContact({{ item.id }}, this)">
                    <i class="fas fa-envelope"></i> Contact Seller
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if not items %}
    <div class="empty-state">
        <i class="fas fa-box-open"></i>
        <h3>No items found</h3>
        <p>Be the first to post an item in this category!</p>
    </div>
    {% endif %}
</div>

<!-- Add Item Modal -->
<div id="addItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Post New Item</h3>
            <span class="close" onclick="closeModal('addItemModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('add_marketplace_item') }}" class="modal-form">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" required></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="price">Price ($)</label>
                    <input type="number" id="price" name="price" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required>
                        <option value="">Select Category</option>
                        <option value="Books">Books</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Sports">Sports & Recreation</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="contact_info">Contact Information</label>
                <input type="text" id="contact_info" name="contact_info" 
                       placeholder="Email or WhatsApp number" required>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addItemModal')">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Post Item
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}